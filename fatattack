_G.FastAttack = true
local seed = game.ReplicatedStorage.Modules.Net.seed:InvokeServer()
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VIM = game:GetService("VirtualInputManager")
local VU = game:GetService("VirtualUser")

local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
local Death = require(ReplicatedStorage.Effect.Container:WaitForChild("Death"))
local Respawn = require(ReplicatedStorage.Effect.Container:WaitForChild("Respawn"))
local RegisterAttack = Net:WaitForChild("RE/RegisterAttack")
local RegisterHit = Net:WaitForChild("RE/RegisterHit")
local BoneCheck = ReplicatedStorage.Remotes.CommF_:InvokeServer("Bones", "Check")

--// Player
local LocalPlayer = Players.LocalPlayer
local HRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

--// Camera & UI
local Camera = workspace.CurrentCamera
local QuestGui = LocalPlayer.PlayerGui.Main.Quest
local QuestTitle = QuestGui.Container.QuestTitle.Title.Text

--// Others
local tickcac = tick()
local Hookfunction = hookfunction or hookfunc
local sethiddenproperty = sethiddenproperty or (function(...) return ... end)
local remote, idremote
for _, v in next, ({game.ReplicatedStorage.Util, game.ReplicatedStorage.Common, game.ReplicatedStorage.Remotes, game.ReplicatedStorage.Assets, game.ReplicatedStorage.FX}) do
    for _, n in next, v:GetChildren() do
        if n:IsA("RemoteEvent") and n:GetAttribute("Id") then
            remote, idremote = n, n:GetAttribute("Id")
        end
    end
    v.ChildAdded:Connect(function(n)
        if n:IsA("RemoteEvent") and n:GetAttribute("Id") then
            remote, idremote = n, n:GetAttribute("Id")
        end
    end)
end

game:GetService("RunService").Heartbeat:Connect(function()
    if _G.FastAttack == true then
        task.defer(function()
            local plr = game.Players.LocalPlayer
            local char = plr.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            local tool = char and char:FindFirstChildOfClass("Tool")
            local parts = {}
            for _, folder in ipairs({workspace.Enemies, workspace.Characters}) do
                for _, obj in ipairs(folder:GetChildren()) do
                    if obj ~= char and obj:FindFirstChild("HumanoidRootPart") and obj:FindFirstChild("Humanoid") then
                        if obj:FindFirstChild("Humanoid").Health > 0 and (obj:FindFirstChild("HumanoidRootPart").Position - root.Position).Magnitude <= 60 then
                            for _, sub in ipairs(obj:GetChildren()) do
                                if sub:IsA("BasePart") then
                                    table.insert(parts, {obj, sub})
                                end
                            end
                        end
                    end
                end
            end

            if #parts == 0 or not remote or not idremote then return end

            table.sort(parts, function(a, b)
                return (a[2].Position - root.Position).Magnitude < (b[2].Position - root.Position).Magnitude
            end)

            if not parts[1][1]:FindFirstChild("Head") then return end

            pcall(function()
                require(game.ReplicatedStorage.Modules.Net):RemoteEvent("RegisterHit", true)
                game.ReplicatedStorage.Modules.Net["RE/RegisterAttack"]:FireServer()
                game.ReplicatedStorage.Modules.Net["RE/RegisterHit"]:FireServer(parts[1][1]:FindFirstChild("Head"), parts, {}, tostring(plr.UserId):sub(2, 4) .. tostring(coroutine.running()):sub(11, 15))
                cloneref(remote):FireServer(string.gsub("RE/RegisterHit", ".", function(c)
                    return string.char(bit32.bxor(string.byte(c), math.floor(workspace:GetServerTimeNow() / 10 % 10) + 1))
                end),
                bit32.bxor(idremote + 909090, seed * 2), parts[1][1]:FindFirstChild("Head"), parts)
            end)
        end)
    end
end)
